<% if (locals.bambi) { %>
  <!-- SINGLE PROFILE VIEW -->
  <a href="/bambis" class="back-to-profiles"><i class="fas fa-arrow-left"></i> Back to Profiles</a>
  
  <div class="profile-container">
    <div class="profile-header">
      <img src="<%= bambi.profilePictureUrl %>" alt="<%= bambi.displayName || bambi.username %>" class="profile-avatar">
    </div>
    
    <div class="profile-details">
      <!-- Row 1: Name and Stats in 5 columns -->
      <div class="profile-row stats-row">
        <div class="profile-name-column">
          <h1 class="profile-name"><%= bambi.displayName || bambi.username %></h1>
          <div class="profile-username">@<%= bambi.username %></div>
        </div>
        
        <div class="stat-column">
          <div class="stat-value"><%= bambi.level %></div>
          <div class="stat-label">Level</div>
        </div>
        
        <div class="stat-column">
          <div class="stat-value"><%= bambi.triggers.length %></div>
          <div class="stat-label">Triggers</div>
        </div>
        
        <div class="stat-column">
          <div class="stat-value"><%= bambi.favoriteFiles.length %></div>
          <div class="stat-label">Favorite Files</div>
        </div>
        
        <div class="stat-column">
          <div class="stat-value heart-container">
            <span id="heartCount"><%= bambi.hearts ? bambi.hearts.count : 0 %></span>
            <button id="heartButton" class="heart-button">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="stat-label">Hearts</div>
        </div>
      </div>
      
      <!-- Row 2: Custom URL and Share Button -->
      <div class="profile-row url-share-row">
        <div class="custom-url">
          <span class="url-label">Profile URL:</span>
          <span class="url-value">bambisleep.chat/bambis/<%= bambi.username %></span>
        </div>
        
        <button id="shareProfileBtn" class="share-button">
          <i class="fas fa-share-alt"></i> Share Profile
        </button>
      </div>
      
      <!-- Row 3: Description -->
      <div class="profile-row description-row">
        <h3>About</h3>
        <div class="profile-description">
          <%= bambi.description || 'No description provided' %>
        </div>
      </div>
      
      <!-- Row 4: Triggers -->
      <div class="profile-row triggers-row">
        <h3 class="triggers-title">Triggers</h3>
        
        <div class="trigger-tags">
          <% if (bambi.triggers && bambi.triggers.length > 0) { %>
            <% bambi.triggers.forEach(trigger => { %>
              <div class="trigger-tag"><%= trigger %></div>
            <% }) %>
          <% } else { %>
            <p>No triggers added yet</p>
          <% } %>
        </div>
      </div>
      
      <!-- Row 5: Recent Activity -->
      <div class="profile-row activity-row">
        <h3>Recent Activity</h3>
        <div class="activity-feed">
          <% if (bambi.activities && bambi.activities.length > 0) { %>
            <% bambi.activities.slice(0, 5).forEach(activity => { %>
              <div class="activity-item">
                <div class="activity-icon">
                  <% if (activity.type === 'file') { %>
                    <i class="fas fa-file-audio"></i>
                  <% } else if (activity.type === 'level') { %>
                    <i class="fas fa-arrow-up"></i>
                  <% } else if (activity.type === 'badge') { %>
                    <i class="fas fa-award"></i>
                  <% } else if (activity.type === 'heart') { %>
                    <i class="fas fa-heart"></i>
                  <% } else { %>
                    <i class="fas fa-star"></i>
                  <% } %>
                </div>
                <div class="activity-details">
                  <p><%= activity.description %></p>
                  <small><%= new Date(activity.timestamp).toLocaleString() %></small>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p>No recent activity</p>
          <% } %>
        </div>
      </div>
      
      <!-- Edit Profile Button -->
      <button id="editProfileBtn" class="edit-profile-btn">Edit Profile</button>
    </div>
    
    <div id="editForm" class="edit-form">
      <h2>Edit Your Profile</h2>
      <form id="profileEditForm">
        <!-- ...edit form elements... -->
      </form>
    </div>
  </div>
<% } else { %>
  <!-- PROFILES LIST VIEW -->
  <h1>Bambi Profiles</h1>
  
  <% if (locals.error) { %>
    <div class="error-message">
      <%= error %>
    </div>
  <% } %>
  
  <div class="create-profile-section">
    <h2>Create Your Bambi Profile</h2>
    <form id="createProfileForm">
      <!-- ...create form elements... -->
    </form>
  </div>
  
  <% if (locals.bambis && bambis.length > 0) { %>
    <div class="profiles-container">
      <% bambis.forEach(bambi => { %>
        <div class="profile-card">
          <!-- ...profile card elements... -->
        </div>
      <% }) %>
    </div>
    
    <!-- Pagination -->
    <% if (locals.totalPages && totalPages > 1) { %>
      <div class="pagination">
        <!-- ...pagination elements... -->
      </div>
    <% } %>
  <% } else if (!locals.error) { %>
    <div class="empty-state">
      <p>No bambi profiles found. Be the first to create one!</p>
    </div>
  <% } %>
<% } %>