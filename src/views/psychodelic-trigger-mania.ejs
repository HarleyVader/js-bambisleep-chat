<!DOCTYPE html>
<html lang="en">
    <%- include('./partials/head.ejs', { title: 'Psychodelic Trigger Mania' }) %>
<style>
    #eyeCursor {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
    }
</style>
<body>
  <%- include('./partials/nav.ejs') %>
  
  <div class="container">
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="error-message">
        <%= typeof errorMessage !== 'undefined' ? errorMessage : 'An error occurred' %>
      </div>
    <% } %>
    
    <div>
      <h1>Psychodelic Trigger Mania</h1>
      <input type="file" id="upload-file" accept=".txt">
      <div id="system-controls-container">
        <%- include('./views/partials/system-controls.ejs', { validConstantsCount: validConstantsCount }) %>
      </div>
      <p id="message"></p>
    </div>
    <div id="chat-container">
      <div id="response-container">
        <div id="eyeCursor">
          <div id="eye" aria-label="Eye Cursor"></div>
        </div>
      </div>
    </div>
    
    <form action="/bambis/update" method="POST">
    </form>
    <a href="/bambis/<%= bambi.username %>">View bambi</a>
    <a href="/bambis/create">Create Bambi bambi</a>
  </div>

  <%- include('./partials/footer.ejs', { footer: typeof footer !== 'undefined' ? footer : {} }) %>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
  <script src="js/psychodelic-trigger-mania.js"></script>
  <script src="js/text2speech.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize BambiSocket
      if (!window.BambiSocket) {
        console.error('BambiSocket not found. Make sure bambi-core.js is loaded.');
      } else {
        window.BambiSocket.initialize();
      }
      
      // Check server-side authentication status
      fetch('/api/auth/status')
        .then(res => res.json())
        .then(data => {
          if (!data.authenticated) {
            modal.style.display = 'block';
          } else {
            window.username = data.username;
          }
        })
        .catch(err => {
          console.error('Authentication check failed:', err);
          modal.style.display = 'block';
        });
    });
  </script>
</body>
</html>