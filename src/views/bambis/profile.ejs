<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head.ejs', { title: `${profile.displayName || profile.username}'s Profile` }) %>

  <body>
    <%- include('../partials/nav.ejs') %>

      <div class="container">
        <% if (typeof error !=='undefined' && error) { %>
          <div class="error-message">
            <%= typeof errorMessage !=='undefined' ? errorMessage : 'An error occurred' %>
          </div>
          <% } %>

            <div class="profile-container" data-username="<%= profile.username %>">
              <!-- User identity section with integrated header and neonwave styling -->
              <div class="profile-identity-section neonwave">
                <!-- Header image moved inside identity section -->
                <div class="profile-header-image" style="background-image: url('<%= profile.headerImage || "
                  /gif/default-header.gif" %>'); background-color: <%= profile.headerColor %>;">
                </div>

                <!-- Profile content container that includes avatar and info -->
                <div class="profile-info-container">
                  <div class="avatar-container">
                    <img src="<%= profile.avatar || '/gif/default-avatar.gif' %>"
                      alt="<%= profile.displayName || profile.username %>" class="profile-avatar neon-glow">
                    <div class="avatar-neon-ring"></div>
                  </div>

                  <div class="profile-info">
                    <div class="profile-header-flex">
                      <h1 class="profile-username neon-text">
                        <%= profile.displayName || profile.username %>
                      </h1>

                      <div class="user-stats-container">
                        <div class="user-stat">
                          <div class="stat-icon level-icon">‚≠ê</div>
                          <div class="stat-value">
                            <%= profile.level || '1' %>
                          </div>
                          <div class="stat-label">Level</div>
                        </div>
                        <div class="user-stat">
                          <div class="stat-icon hearts-icon">‚ù§Ô∏è</div>
                          <div class="stat-value">
                            <%= profile.hearts || '0' %>
                          </div>
                          <div class="stat-label">Hearts</div>
                        </div>
                        <div class="user-stat">
                          <div class="stat-icon scrapes-icon">üîÑ</div>
                          <div class="stat-value">
                            <%= profile.scrapes || '0' %>
                          </div>
                          <div class="stat-label">Scrapes</div>
                        </div>
                        <div class="user-stat">
                          <div class="stat-icon controls-icon">‚öôÔ∏è</div>
                          <div class="stat-value">
                            <%= profile.controls || '0' %>
                          </div>
                          <div class="stat-label">Controls</div>
                        </div>
                      </div>
                    </div>

                    <div class="profile-about clickable-links neon-text-subtle">
                      <%=
                        profile.about.replace(/https?:\/\/[^\s]+/g, '<a href="$&" target="_blank" rel="noopener noreferrer" class="neon-link">$&</a>'
                        ) %>
                    </div>

                    <div class="profile-description-container cyber-panel">
                      <h2 class="neon-heading">Description</h2>
                      <div class="profile-description cyber-text">
                        <%= profile.description %>
                      </div>
                    </div>

                    <% if (isOwnProfile) { %>
                      <div class="profile-actions">
                        <button id="edit-profile-btn" class="neon-button">Edit Profile</button>
                        <button id="delete-profile-btn" class="neon-button danger">Delete Profile</button>
                      </div>
                      <% } %>
                  </div>
                </div>
              </div>

              <!-- Rest of your content... -->
            </div>

            <!-- Profile Edit Modal -->
            <div id="profile-edit-modal" class="modal">
              <!-- Modal content... -->
            </div>

            <div class="notification-area"></div>
      </div>

      <%- include('../partials/footer.ejs', { footer: typeof footer !=='undefined' ? footer : {} }) %>

        <script src="/socket.io/socket.io.js"></script>
        <script src="/js/socket-client.js"></script>