<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs', { title: 'Create Bambi bambi' }) %>
<body>
  <%- include('./partials/nav.ejs') %>
  
  <div class="container">
    <div class="creation-container">
      <h1 class="neon-text">Create Bambi bambi</h1>
      
      <form action="/bambis" method="POST" class="bambi-form" enctype="multipart/form-data">
        <div class="form-group">
          <label for="displayName">Display Name</label>
          <input type="text" id="displayName" name="displayName" required>
        </div>
        
        <div class="form-group">
          <label for="about">About Me</label>
          <textarea id="about" name="about" rows="4"></textarea>
        </div>
        
        <div class="form-group">
          <label for="avatar">bambi Picture</label>
          <input type="file" id="avatar" name="avatar" accept="image/*">
        </div>
        
        <div class="form-actions">
          <button type="submit" class="submit-btn">Create bambi</button>
          <a href="/bambis" class="cancel-btn">Cancel</a>
        </div>
      </form>
    </div>
  </div>

  <%- include('./partials/footer.ejs', { footer: typeof footer !== 'undefined' ? footer : {} }) %>
  
  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize form validation
      const form = document.querySelector('.bambi-form');
      if (form) {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          // Use the form validation from bambi-forms.js
          if (!window.validateForm(this)) {
            return;
          }
          
          // Continue with form submission
          this.submit();
        });
      }
      
      // Check server-side authentication status
      fetch('/api/auth/status')
        .then(res => res.json())
        .then(data => {
          if (!data.authenticated) {
            modal.style.display = 'block';
          } else {
            window.username = data.username;
          }
        })
        .catch(err => {
          console.error('Authentication check failed:', err);
          modal.style.display = 'block';
        });

      // Initialize BambiSocket
      if (!window.BambiSocket) {
        console.error('BambiSocket not found. Make sure bambi-core.js is loaded.');
      } else {
        window.BambiSocket.initialize();
      }
    });
  </script>
</body>
</html>