<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs', { title: 'Delete bambi' }) %>
<body>
  <%- include('./partials/nav.ejs') %>
  
  <div class="container">
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="error-message">
        <%= typeof errorMessage !== 'undefined' ? errorMessage : 'An error occurred' %>
      </div>
    <% } %>
    
    <div class="bambi-container">
      <h1>Delete Your bambi</h1>
      
      <div class="alert alert-warning">
        <p><strong>Warning:</strong> You are about to delete your bambi. This action cannot be undone.</p>
      </div>
      
      <div class="bambi-summary">
        <h2>bambi Summary</h2>
        <div class="bambi-info">
          <p><strong>Username:</strong> <%= bambi.username %></p>
          <p><strong>Display Name:</strong> <%= bambi.displayName || 'Not set' %></p>
          <p><strong>Created:</strong> <%= new Date(bambi.createdAt).toLocaleDateString() %></p>
          <p><strong>Triggers:</strong> <%= bambi.triggers ? bambi.triggers.length : 0 %></p>
        </div>
      </div>
      
      <div class="confirmation-actions">
        <form action="/bambis/<%= bambi.username %>/update" method="POST"></form>
        <form id="delete-form" method="POST" action="/bambis/<%= bambi.username %>/delete">
          <button type="submit" class="delete-bambi-btn">Yes, Delete My bambi</button>
        </form>
        <a href="/bambis/<%= bambi.username %>" class="cancel-btn">Cancel</a>
      </div>
    </div>

    <div class="notification-area"></div>
  </div>

  <%- include('./partials/footer.ejs', { footer: typeof footer !== 'undefined' ? footer : {} }) %>
  
  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('delete-form').addEventListener('submit', function(e) {
        if (!confirm('Are you absolutely sure you want to delete your bambi? This cannot be undone!')) {
          e.preventDefault();
        }
      });

      // Check server-side authentication status
      fetch('/api/auth/status')
        .then(res => res.json())
        .then(data => {
          if (!data.authenticated) {
            const modal = document.getElementById('bambiname-modal') || document.getElementById('username-modal');
            if (modal) {
              modal.style.display = 'block';
            } else {
              console.error('Authentication modal not found');
            }
          } else {
            window.username = data.username;
          }
        })
        .catch(err => {
          console.error('Authentication check failed:', err);
        });

      // Initialize BambiSocket
      if (!window.BambiSocket) {
        console.error('BambiSocket not found. Make sure bambi-core.js is loaded.');
      } else {
        window.BambiSocket.initialize();
      }
    });
  </script>
</body>
</html>